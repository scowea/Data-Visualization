<!doctype html>
<!-- 
Author: Scott M Weaver
Date: 2014-02-01	
-->
<html lang="en">
 	<head>
  		<title>Visualizing Hope</title>
  		<meta charset="utf-8">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1.0">
 
    	<link rel="icon" type="image/x-icon" href="favicon.ico" />
    	
     	<link href="css/bootstrap.min.css" rel="stylesheet">
    	<link href="css/jumbotron.css" rel="stylesheet">
    	<link href="css/googlemap.css" rel="stylesheet">
    
 		
 		<script src="js/jquery.js"></script>
				
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=visualization"></script>
		
		<script src="js/oms.min.js"></script>
		
		<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />
		<script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"></script>
		

		
		

		<script>
// get the viz.json url from the CartoDB Editor
// - click on visualize
// - create new visualization
// - make visualization public
// - click on publish
// - go to API tab

	window.onload = function() {
		var url = 'https://scott-the-weaver.cartodb.com/api/v2/viz/c7487258-4766-11e4-a794-0e853d047bba/viz.json';
  		var torqueLayer;
	    cartodb.createVis('timelapse-map', url, {
	        shareable: true,
	        title: true,
	        description: true,
	        search: true,
	        tiles_loader: true
	    })
	    .done(function(vis, layers) {
	      //First layer is the basemap, the second is the Torque layer
	      torqueLayer = layers[1];
	      torqueLayer.stop(); // no autoplay of timelapse
	    })
	    .error(function(err) {
	      console.log(err);
	    });
  		
	};
	
</script>

<script>
// create the map 

function initialize() {
  
 
  	
  	// mark the spot
	//var firstmarker = new google.maps.Marker({
    //	position: myLatlng,
    //  	map: map,
    //  	title: 'The White House'
	//});
	
	
	

	
} // end function initialize() {



 	     
	





</script>
	<script>
//#####################################################################################
	

count_per_year_arr = new Array();
year_labels_arr = new Array();
year_data_arr = new Array();
year_arr_index = 0;
   




heat_map_data_arr = new Array();   
   
count_per_month_arr = new Array();
month_labels_arr = new Array();
month_data_arr = new Array();
month_arr_index = 0;

count_per_day_arr = new Array();
day_labels_arr = new Array();
day_data_arr = new Array();
day_arr_index = 0;

count = 0;
percentage_loaded = 0;
google_spreadsheet_id = '1Nje2Q1ZsVPZprkw7DCCdOQJzL95hQL6SSYjpr12rd1U';
apiurl = "https://spreadsheets.google.com/feeds/list/"+google_spreadsheet_id+"/od6/public/values?alt=json";
apiurl_html = "https://docs.google.com/spreadsheets/d/"+google_spreadsheet_id+"/pubhtml";
apikey = "";


var prev_infowindow = false;
var prev_infowindow_animate = false;
var lat_lng_counter = 0;

//apiurl = "https://api.flickr.com/services/rest/?method=flickr.photos.search&format=json&jsoncallback=?&api_key=dd4eb2f7ebff37400f01aae57493f41e&tags=obama,hope&tag_mode=all&extras=date_taken,geo&has_geo=1";
//Key:dd4eb2f7ebff37400f01aae57493f41e
//Secret:7a6541283f6e96bf
//sort=date-posted-asc (the default value), date-posted-desc, date-taken-asc, date-taken-desc
//Important Dates:
//   Obama elected: 2008-11-4 (november 4, 2008)

// &has_geo=1 
// &sort=date-taken-asc
 
//..........................................................................    
$(document).ready(function(){
    
	var myLatlng = new google.maps.LatLng(35.232471, 9.319066);//(38.89808,-77.036523);
	var mapOptions = { zoom: 2, center: myLatlng, mapTypeId: google.maps.MapTypeId.SATELLITE, minZoom: 2 };// satillite view
	map = new google.maps.Map(document.getElementById('temporal-canvas'), mapOptions);    
	
	// create a spiderfier.. so if multiple markers are on the same exact coordinate, we can still click them
	var oms = new OverlappingMarkerSpiderfier(map);  
	
	// add a global window
	var iw = new google.maps.InfoWindow();
	
	// add a click listener on the OMS
	oms.addListener('click', function(marker) {
        iw.setContent(marker.desc);
        iw.open(map, marker);
        
        // zoom in after clicking the marker if we arent already zoomed in to at least 4
        if (map.getZoom() < 4) { 
			map.setZoom(4);
		}
    });
    
    // add a listener to the spiderfy event.. when the markers spread out 
    oms.addListener('spiderfy', function(markers) {        
    	// close any open info windows
        iw.close();
    });
	 		
    // get the data from flickr
    // see how many pages of photos we have...
    $.getJSON(apiurl,function(json){
    	
    	// show status messages...
    	$("#flickr_count").html('<p>Loading Photos: '+count+'</p>');
    	$("#loading_progressbar").html(percentage_loaded); 
	    $("#data_source").html("[<a target=_blank href="+apiurl+">Data Source</a>]");
	    
	    console.debug('opensearch$totalResults = ' + json.feed.openSearch$totalResults.$t);
	    
	    // total of all photos across all pages
	    total_photos = json.feed.openSearch$totalResults.$t;
	    
		//.............................................................
		// zero out the day/year/month counters
		
		current_year = new Date().getFullYear();
		
		for (this_year = 2006; this_year <= current_year; this_year++)
		{
			count_per_year_arr[this_year] = 0;
				    	
			for(this_month = 1; this_month <= 12; this_month++)
			{				
				count_per_month_arr[this_month+''+this_year] = 0;   		

	    		// only collect the dailydata for january.
	    		if ((this_year == 2009) && (this_month == 1))
	    		{  		
					for(this_day = 1; this_day <= 31; this_day++)
					{				
						count_per_day_arr[this_day+''+this_month+''+this_year] = 0;   		
					} // end for(this_day = 1; this_day <= 12; this_day++)   						   		
				} // end if ((this_year == 2009) && (this_month == 1))				   						   		
			} // end for(this_month = 1; this_month <= 12; this_month++)
		} // end for (this_year = 2006; this_year <= currentYear; this_year++)   
    	

 	     
	    //..................................................................
	    // roll through the pages of photos...
	    //for (var this_page=1;this_page<=json.photos.pages;this_page++)
	    //{
	    	// get data for this page of photos
	    //	$.getJSON(apiurl+'&page='+this_page,function(json){
	    		
	    		// get each photo info..
	    		$.each(json.feed.entry,function(i,this_photo){
					
//					if ((this_photo.gsx$datetaken.$t !== '') && (this_photo.gsx$datetaken.$t.substr(0,2) !== '') && (this_photo.gsx$datetaken.$t.substr(3,2)) && (this_photo.gsx$datetaken.$t.substr(6,4)))
//					{

					
					count++; // count each photo as we process it...
					$("#flickr_data").append(count + ': '+ this_photo.gsx$datetaken.$t+';'+this_photo.gsx$address.$t+','+this_photo.gsx$urltojpg.$t+'|');
					$("#flickr_count").html('<p>Loading Photos From Google Spreadsheet: <b>'+count+'</b></p>');					
					$("#status_message").html('<h2>One Moment Please...</h2>');
					
					// get the month and year of the date this photo was taken		
					month = this_photo.gsx$datetaken.$t.substr(0,2);
					day = this_photo.gsx$datetaken.$t.substr(3,2);
					year = this_photo.gsx$datetaken.$t.substr(6,4);
					
					//console.debug('|'+year+'|');
					
					// strip leading zeros from the month or day
					// EX: datetaken":"2013-11-05 13:28:40
					if (month.substr(0,1) === '0')
						month = month.substr(1,1);
					if (day.substr(0,1) === '0')
						day = day.substr(1,1);		
					
					// increment the counter for the year this photo was taken
					count_per_year_arr[year]++; 
					//console.debug(year +' counter'+count_per_year_arr[year]);
					
					// increment the counter for the month and year this photo was taken     		
					count_per_month_arr[month+''+year]++;   		

	    			// only collect the daily data for january.
	    			//if ((year == 2009) && (month == 1))
	    			//{
						// increment the counter for the month and year this photo was taken     		
						count_per_day_arr[day+''+month+''+year]++;   	   		
					//}
					
					/*
					// calculate the progress bar percentage
					var progress_bar = document.getElementById('progress-bar');
					percentage_loaded = (count * 100)/total_photos;
					progress_bar.style.width = percentage_loaded+'%';
					progress_bar.style.visibility="hidden";
					*/
					// show the ending total count
	    			if (count >= (total_photos-250))
	    			{
	    				$("#status_message").html(''); // clear the status message
						$("#flickr_count").html('<p>Photos Loaded: <b>'+total_photos+'</b> [<a target=_blank href='+apiurl+'>JSON</a>][<a target=_blank href='+apiurl_html+'>Data Source</a>]</p>');
						//progress_bar.style.width = '100%';
						
						// we are done so hide the progress bar
						//var progress_bar = document.getElementById('progress-bar');
						//progress_bar.style.visibility="hidden";
						
					} // end if (count >= (total_flickr_photos-250))	  
					
					
					
					//.................
					// in for loop:
					var lat = this_photo.gsx$latitude.$t; //this_photo.latitude; 
					var lng = this_photo.gsx$longitude.$t; //this_photo.longitude;
					
					if ((lat != "") && (lng != ""))
					{
						
						// geo code this address
						//var geocode_url = "https://maps.googleapis.com/maps/api/geocode/json?address=" + this_photo.gsx$address.$t + "&key=" + api_key;
						//$.getJSON("https://maps.googleapis.com/maps/api/geocode/json?address=" . ,function(json){
						//https://maps.googleapis.com/maps/api/geocode/json?address=1600+Amphitheatre+Parkway,+Mountain+View,+CA&key=API_KEY
						
					  	var myLatlng = new google.maps.LatLng(lat,lng);	
					  	heat_map_data_arr[count-1] = myLatlng;  
					  					  					
					  	//var thumbnail = 'http://farm'+ this_photo.farm + '.staticflickr.com/'+ this_photo.server+ '/'+this_photo.id+'_'+this_photo.secret+'_t.jpg';
					  	var thumbnail = this_photo.gsx$urltojpg.$t;
					  	// Format: http://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}_[mstzb].jpg
					  	// this_photo.secret
						// this_photo.farm
						// this_photo.id
						
					  	var marker = new google.maps.Marker({
					    	position: myLatlng,
					      	map: map,
					    	title: jQuery.trim(this_photo.gsx$description.$t),
					     	visible: true,
	  						clickable: true,
	  						icon: './docs-assetts/small_dot.png'
	  					//	zIndex: count // puts the newest thumbnails on top of the stack
	  						//shadow: 'http://www.mysite.com/markershadow.png'
						});
						
						
						var infowindow_html = '<h3>'+this_photo.gsx$description.$t+'</h3>';
						infowindow_html += '<img src="'+thumbnail+'" width=200px height=200px alt="'+this_photo.gsx$description.$t+'" ><br><br>';
						infowindow_html += '<b>Date Taken:</b> '+ this_photo.gsx$datetaken.$t + '<br>';
						infowindow_html += '<b>Address:</b> '+this_photo.gsx$address.$t + '<br>';
						infowindow_html += '<b>Latitude:</b> '+this_photo.gsx$latitude.$t + '<br>';
						infowindow_html += '<b>Longitude:</b> '+this_photo.gsx$longitude.$t + '<br>';
						infowindow_html += '<b>Media:</b> '+this_photo.gsx$media.$t + '<br>';
						infowindow_html += '<b>Genre:</b> '+this_photo.gsx$genre.$t + '<br>';
						infowindow_html += '<b>Art Form:</b> '+this_photo.gsx$artform.$t + '<br>';
						infowindow_html += '<b>Function:</b> '+this_photo.gsx$function.$t + '<br>';
						infowindow_html += '<b>Obamicon?:</b> '+this_photo.gsx$isobamacon.$t + '<br>';
						infowindow_html += '<b>Designer:</b> '+this_photo.gsx$designer.$t + '<br>';
						infowindow_html += '<b>Photographer:</b> '+this_photo.gsx$photographer.$t + '<br>';
						infowindow_html += '<b>Source:</b> <a target=_blank href="'+this_photo.gsx$otherlinks.$t+'">'+this_photo.gsx$otherlinks.$t + '</a><br>';
						
						
						//var infowindow = new google.maps.InfoWindow({
	      				//	content: infowindow_html//'<h3>'+this_photo.gsx$description.$t+'</h3><img src="'+thumbnail+'" width=200px height=200px alt="'+this_photo.gsx$description.$t+'" ><br>' 
	  					//});
	
	  					/*
	  					google.maps.event.addListener(marker, 'click', function() {
	  						if (prev_infowindow) { prev_infowindow.close();} // close any other infowindows that happen to be open
	  						prev_infowindow = infowindow;
	  						
	    					infowindow.open(map,marker);
	    					
	    					// zoom in after clicking the marker
							map.setZoom(3);
	  					});
	  					*/
	  					
	  					// save off the contents of this info window into a attribute of the marker
						marker.desc = infowindow_html;	
					
						// tell the overlappingMarkerSpiderfier instance about each marker as we add it
						oms.addMarker(marker);  // <-- here						
	  					
	  					lat_lng_counter++;
	  					$("#num_plotted_images").html('Photos With Coordinates: <b>' + lat_lng_counter + '</b>');
  					}
					//............................
										
				}); // end $.each(json.photos.photo,function(i,myresult){
					
	    	}); // end $.getJSON(apiurl,function(json){    
	    		
	 //    } // end for (var this_page=1;this_page<=num_photo_pages;this_page++)
	
	 //}); // end $.getJSON(apiurl,function(json){
	
	//............................................................................
		
	//$(window).load(function() {

		// build the heat map
 	    var pointArray = new google.maps.MVCArray(heat_map_data_arr);
		heatmap = new google.maps.visualization.HeatmapLayer({
    		data: pointArray
		});
		
		//heatmap.setMap(map); 
		
		heatmap.setMap(heatmap.getMap() ? null : map);
		// set the radius of affected pixels
		//heatmap.set('radius', heatmap.get('radius') ? null : 20); // 50 pixels

		// set an alternate gradient of colors
 		/*
 		var gradient = [
		    'rgba(0, 255, 255, 0)',
		    'rgba(0, 255, 255, 1)',
		    'rgba(0, 191, 255, 1)',
		    'rgba(0, 127, 255, 1)',
		    'rgba(0, 63, 255, 1)',
		    'rgba(0, 0, 255, 1)',
		    'rgba(0, 0, 223, 1)',
		    'rgba(0, 0, 191, 1)',
		    'rgba(0, 0, 159, 1)',
		    'rgba(0, 0, 127, 1)',
		    'rgba(63, 0, 91, 1)',
		    'rgba(127, 0, 63, 1)',
		    'rgba(191, 0, 31, 1)',
		    'rgba(255, 0, 0, 1)'
  		];
  		heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
 		*/
 		//heatmap.set('opacity', heatmap.get('opacity') ? null : 2);

		// debugging
		console.debug('num elements in heat map data array = ' + heat_map_data_arr.length);
		console.debug('window load: HeatMapData:  data array = ' + heat_map_data_arr);
		console.debug('window load: PointData:  data array = ' + pointArray);
		
	//});	// end $(window).load(function() {	
		



	google.maps.event.addDomListener(window, 'load', initialize);
	
		
}); // end $(document).ready(function(){
	
	function toggleHeatmap() {
  		heatmap.setMap(heatmap.getMap() ? null : map);
	}	
	
	function changeGradient() {
  var gradient = [
    'rgba(0, 255, 255, 0)',
    'rgba(0, 255, 255, 1)',
    'rgba(0, 191, 255, 1)',
    'rgba(0, 127, 255, 1)',
    'rgba(0, 63, 255, 1)',
    'rgba(0, 0, 255, 1)',
    'rgba(0, 0, 223, 1)',
    'rgba(0, 0, 191, 1)',
    'rgba(0, 0, 159, 1)',
    'rgba(0, 0, 127, 1)',
    'rgba(63, 0, 91, 1)',
    'rgba(127, 0, 63, 1)',
    'rgba(191, 0, 31, 1)',
    'rgba(255, 0, 0, 1)'
  ]
  heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
}

function changeRadius() {
  heatmap.set('radius', heatmap.get('radius') ? null : 20);
}


//#####################################################################################


		</script>
			
		
  	</head>

	<body>
  	
    	<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    		<div class="container">
        		<div class="navbar-header">
          			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            			<span class="sr-only">Toggle navigation</span>
            			<span class="icon-bar"></span>
            			<span class="icon-bar"></span>
            			<span class="icon-bar"></span>
          			</button>
          
          			<a class="navbar-brand" href="index.html">Visualizing Hope</a>
        		</div><!--/.navbar-header -->
        
        		<div class="collapse navbar-collapse">
          			<ul class="nav navbar-nav">
          		   	  <li ><a href="index.html">Home</a></li>
			          <!-- <li><a href="introduction.html">Introduction</a></li> -->
			          <li><a href="methodology.html">Methodology</a></li>
			          <li><a href="coding.html">Coding</a></li>
			          <li class="active"><a href="spatio_temporal.html">Spatio-Temporal</a></li>
			          <li><a href="genre.html">Genre</a></li>
			          <li><a href="media.html">Media</a></li>
			          <li><a href="function.html">Function</a></li>
			          <li><a href="obamicon_frequency_chart.html">Obamicons</a></li>		
			          <li><a href="collective_networking.html">Collective Networking</a></li>            
			          <li><a href="conclusion.html">Conclusion</a></li>
       
          			</ul>
        		</div><!--/.nav-collapse -->
    		</div><!--/.container -->
      
		</div><!--/.navbar -->
		
		<!--  <div id="map_container"></div>  -->	  
	  <!-- <div class="container"> -->	
		
	
      <div class="container">  		
       		
			<p><br /></p>
       		
       		<h2>Spatio-Temporal Maps</h2>		 
	
			<p>This set of maps indicates the places to which Obama Hope has circulated both within and beyond the U.S. border. Like other geographic information, these maps consists of two components: a spatial component, such as a city, street, or business name, and a thematic component, which assigns some attribute to that location (Lancaster). Yet Maps 2 and 3 also incorporate a temporal dimension in order to gain a sense of how Obama Hope circulated spatially in time as well as the rate of its uptake across the world. By finding correlations between space, time, and thematic information then, we are able to disover...</p>
		
					<p>The first is a heat map, showing where and when the image showed up across the world.  You can zoom in on cities such as Log Angeles where many sightings of the image were documented.</p>
			
			<div id="flickr_count"></div>
			<div id="num_plotted_images"></div><br>
			<button onclick="toggleHeatmap()">Toggle Heatmap</button>
			<button onclick="changeGradient()">Change gradient</button>
            <button onclick="changeRadius()">Change radius</button>

  			<div id="temporal-canvas" style="width: 100%; height: 500px"></div>
			<hr />
       		

  			  
			<p> To get idea of how the obama hope image circulated, although this story can’t be told, I entered in chronological dates where image showed up on heat map. Viewers can click on “Play/Pause” and see how it moved.</p>

	<div id="timelapse-map" style="width: 100%; height: 500px"></div>
	
       			
			
	
			
					
		
  				<hr />		
			<p>
			<a class="btn btn-success btn-lg" role="button" href="genre.html" >Continue &raquo; Genre</a>
			</p>
			<hr />        					
      		<footer>
        		<p>&copy; <a href=http://eWeaverSolutions.com target=_blank>eWeaver Solutions</a> 2014</p>
      		</footer>
</div>      	
    
    	<!-- Bootstrap core JavaScript
    	================================================== -->
    	<!-- Placed at the end of the document so the pages load faster -->
  
    	<script src="js/bootstrap.min.js"></script>
	</body>
</html>